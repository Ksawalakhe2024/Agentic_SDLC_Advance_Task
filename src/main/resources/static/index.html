<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MCP Agent Chat (Local H2)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --card: #1f2937;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --accent: #60a5fa;
      --accent-2: #34d399;
    }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial;
      background: linear-gradient(120deg, #0f172a, #1f2937 60%, #0f172a); color: var(--text); min-height: 100vh;
      display: grid; grid-template-rows: auto 1fr auto; }
    header, footer { padding: 12px 16px; background: rgba(17,24,39,0.7); backdrop-filter: blur(6px); border-bottom: 1px solid #374151; }
    header h1 { font-size: 18px; margin: 0; } header small { color: var(--muted); }
    .container { display: grid; grid-template-columns: 1fr; gap: 12px; padding: 16px; max-width: 980px; width: 100%; margin: 0 auto; }
    .chat-window { background: rgba(31,41,55,0.75); border: 1px solid #374151; border-radius: 10px; overflow: hidden;
      display: grid; grid-template-rows: 1fr auto; min-height: 60vh; }
    .messages { padding: 16px; overflow-y: auto; }
    .msg { margin: 10px 0; padding: 12px 14px; border-radius: 10px; line-height: 1.4; white-space: pre-wrap; }
    .user { background: #0b3b69; border: 1px solid #1f3b57; } .assistant { background: #063b2f; border: 1px solid #0f5132; }
    .input-row { display: grid; grid-template-columns: 1fr auto; gap: 8px; padding: 10px; border-top: 1px solid #374151; background: rgba(17,24,39,0.6); }
    input[type="text"] { background: #0b1220; color: var(--text); border: 1px solid #334155; border-radius: 8px; padding: 10px 12px; outline: none; font-size: 14px; }
    button { background: linear-gradient(135deg, var(--accent), var(--accent-2)); color: #0b1220; border: none; border-radius: 8px; padding: 10px 16px; font-weight: 600; cursor: pointer; }
    .code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: #0b1220; border: 1px solid #1f2937; border-radius: 8px; padding: 10px; display: block; overflow-x: auto; white-space: pre; color: #93c5fd; }
  </style>
</head>
<body>
  <header><h1>MCP Agent Chat <small>(Local H2)</small></h1></header>
  <main class="container">
    <div class="chat-window">
      <div id="messages" class="messages"></div>
      <div class="input-row">
        <input id="input" type="text" placeholder='Try: "show schema", "generate 1000 tasks", "show summary"' />
        <button id="send">Send</button>
      </div>
    </div>
  </main>
  <footer>Local-only demo UI. Data stored in ./data/mcpdb (H2 file).</footer>
  <script>
    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('send');

    function addMsg(role, text, data) {
      const wrap = document.createElement('div');
      wrap.className = 'msg ' + (role === 'user' ? 'user' : 'assistant');
      wrap.innerText = text;
      messagesEl.appendChild(wrap);

      if (data && Object.keys(data).length) {
        const pre = document.createElement('pre');
        pre.className = 'code';
        pre.textContent = JSON.stringify(data, null, 2);
        messagesEl.appendChild(pre);
      }
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    async function send() {
      const text = inputEl.value.trim();
      if (!text) return;
      addMsg('user', text);
      inputEl.value = '';
      sendBtn.disabled = true;
      try {
        const res = await fetch('/chat', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ message: text }) });
        const json = await res.json();
        addMsg('assistant', json.reply || '(no reply)', json.data || {});
      } catch (e) {
        addMsg('assistant', 'Error: ' + e.message);
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener('click', send);
    inputEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') send(); });

    // Greeting
    addMsg('assistant', 'Hello! I can show the schema, generate and insert tasks (e.g., "generate 1000 tasks"), and show summary.');
  </script>
</body>
</html>